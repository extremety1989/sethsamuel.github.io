!function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}({0:function(t,e,r){t.exports=r(22)},1:function(t,e){"use strict";function r(t,e){function r(){var t=2*Math.pow(2,Math.floor(Math.log2(Math.min(window.innerWidth,window.innerHeight))))*n;i.width=t,i.height=t,i.style.width=t/2+"px",i.style.height=t/2+"px",o.viewport(0,0,i.width,i.height)}var n=arguments.length<=2||void 0===arguments[2]?1:arguments[2],i=(document.body,document.querySelector("canvas")),o=i.getContext("webgl2");r(),window.addEventListener("resize",r),o.clearColor(0,0,0,1),o.clear(o.COLOR_BUFFER_BIT);var a=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(a,t),o.compileShader(a),!o.getShaderParameter(a,o.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+o.getShaderInfoLog(a));console.log("Vertex shader compiled");var u=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(u,e),o.compileShader(u),!o.getShaderParameter(u,o.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+o.getShaderInfoLog(u));console.log("Fragment shader compiled");var s=o.createProgram();if(o.attachShader(s,a),o.attachShader(s,u),o.linkProgram(s),!o.getProgramParameter(s,o.LINK_STATUS))throw new Error("Unable to initialize the shader program.");return console.log("Initialized shader program"),o.useProgram(s),{gl:o,shaderProgram:s}}function n(){var t=document.querySelector("canvas").getContext("webgl2"),e=t.createTexture();return t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),e}Object.defineProperty(e,"__esModule",{value:!0}),e.createProgram=r,e.createTexture=n},2:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={vertexSource:"#version 300 es\n\t\tprecision highp float;\n\t\tin vec3 aPosition;\n\t\tout vec2 vTexturePosition;\n\t\tout vec2 vPosition;\n\t\tvoid main(void) {\n\t\t\tvPosition = aPosition.xy;\n\t\t\tvTexturePosition = vec2(aPosition.x + 1.0, -1.0 + aPosition.y) * 0.5;\n\t\t\tgl_Position = vec4(aPosition, 1.0);\n\t\t}\n\t",fragmentSource:"#version 300 es\n\t\tprecision highp float;\n\t\tuniform sampler2D uSampler;\n\t\tuniform float uScale;\n\t\tin vec2 vTexturePosition;\n\t\tin vec2 vPosition;\n\t\tout vec4 fragmentColor;\n\n\t\tvoid main(void) {\n\t\t\tfragmentColor = texture(uSampler, vTexturePosition/uScale);\n\t\t}\n\t"};e["default"]=r},3:function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(1),a=function(){function t(e){var r=e.shaderSource,i=e.scale,a=void 0===i?1:i;n(this,t);var u=(0,o.createProgram)(r.vertexSource,r.fragmentSource,a),s=u.gl,f=u.shaderProgram;this.gl=s,this.shaderProgram=f,this.currentState=0,this.vertexBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),this.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],s.bufferData(s.ARRAY_BUFFER,new Float32Array(this.vertices),s.STATIC_DRAW);var c=s.getAttribLocation(f,"aPosition");s.enableVertexAttribArray(c),s.vertexAttribPointer(c,3,s.FLOAT,!1,0,0);var l=s.getUniformLocation(f,"uWidth");s.uniform1f(l,s.canvas.width)}return i(t,[{key:"draw",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1],r=this.gl;r.useProgram(this.shaderProgram);var n=r.getUniformLocation(this.shaderProgram,"uScale");r.uniform1f(n,1),e(),r.bindTexture(r.TEXTURE_2D,t),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.drawArrays(r.TRIANGLE_STRIP,0,this.vertices.length/3),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindTexture(r.TEXTURE_2D,null)}}]),t}();e["default"]=a},4:function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(1),a=function(){function t(e){var r=e.shaderSource,i=e.scale,a=void 0===i?1:i;n(this,t);var u=(0,o.createProgram)(r.vertexSource,r.fragmentSource,a),s=u.gl,f=u.shaderProgram;this.gl=s,this.shaderProgram=f,this.currentState=0,this.iteration=0,this.vertexBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),this.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],s.bufferData(s.ARRAY_BUFFER,new Float32Array(this.vertices),s.STATIC_DRAW);var c=s.getAttribLocation(f,"aPosition");s.enableVertexAttribArray(c),s.vertexAttribPointer(c,3,s.FLOAT,!1,0,0);var l=s.getUniformLocation(f,"uWidth");s.uniform1f(l,s.canvas.width),this.uShouldUpdate=s.getUniformLocation(f,"uShouldUpdate"),this.uIteration=s.getUniformLocation(f,"uIteration"),this.tTexture0=(0,o.createTexture)(),this.tTexture1=(0,o.createTexture)(),this.frameBuffer=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer),this.frameBuffer.width=s.canvas.width,this.frameBuffer.height=s.canvas.height,s.bindTexture(s.TEXTURE_2D,this.tTexture1),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.frameBuffer.width,this.frameBuffer.height,0,s.RGBA,s.UNSIGNED_BYTE,null);var h=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,h),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,this.frameBuffer.width,this.frameBuffer.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,h),s.bindRenderbuffer(s.RENDERBUFFER,null),s.bindFramebuffer(s.FRAMEBUFFER,null)}return i(t,[{key:"setState",value:function(t){var e=this.gl;e.bindTexture(e.TEXTURE_2D,this.tTexture0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.bindTexture(e.TEXTURE_2D,null)}},{key:"drawState",value:function(){var t=this.gl;t.useProgram(this.shaderProgram),t.uniform1i(this.uShouldUpdate,0),t.bindFramebuffer(t.FRAMEBUFFER,null),0==this.currentState?t.bindTexture(t.TEXTURE_2D,this.tTexture0):t.bindTexture(t.TEXTURE_2D,this.tTexture1),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.drawArrays(t.TRIANGLE_STRIP,0,this.vertices.length/3),t.bindBuffer(t.ARRAY_BUFFER,null)}},{key:"incrementState",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.mousePosition,r=this.gl;r.useProgram(this.shaderProgram),r.uniform1i(this.uShouldUpdate,1),r.uniform1i(this.uIteration,this.iteration),this.iteration++;var n=r.getUniformLocation(this.shaderProgram,"uMousePosition");e&&2==e.length?r.uniform2f(n,e[0],e[1]):r.uniform2f(n,-10,-10),r.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer),0==this.currentState?(r.bindTexture(r.TEXTURE_2D,this.tTexture0),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.tTexture1,0)):(r.bindTexture(r.TEXTURE_2D,this.tTexture1),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.tTexture0,0)),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.drawArrays(r.TRIANGLE_STRIP,0,this.vertices.length/3),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),this.currentState=(this.currentState+1)%2}},{key:"stateTexture",value:function(){return 0==this.currentState?this.tTexture0:this.tTexture1}}]),t}();e["default"]=a},18:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={vertexSource:"#version 300 es\n\t\tprecision highp float;\n\t\tin vec3 aPosition;\n\t\tout vec2 vTexturePosition;\n\t\tout vec2 vPosition;\n\t\tvoid main(void) {\n\t\t\tvPosition = aPosition.xy;\n\t\t\tvTexturePosition = vec2(aPosition.x + 1.0, (1.0 + aPosition.y)) * 0.5;\n\t\t\tgl_Position = vec4(aPosition, 1.0);\n\t\t}\n\t",fragmentSource:"#version 300 es\n\t\tprecision highp float;\n\t\tuniform sampler2D uSampler;\n\t\tuniform float uScale;\n    uniform int uIteration;\n\t\tin vec2 vTexturePosition;\n\t\tin vec2 vPosition;\n\t\tout vec4 fragmentColor;\n\n\t\tvoid main(void) {\n\t\t\tif (texture(uSampler, vTexturePosition).z > 0.0) {\n\t\t\t\tfragmentColor = vec4(0,0,texture(uSampler, vTexturePosition).z,1.0);\n\t\t\t\treturn;\n\t\t\t} else if (uIteration > 1000) {\n\t\t\t\tfragmentColor = vec4(0,0,0,1.0);\n\t\t\t\tfragmentColor = vec4(texture(uSampler, vTexturePosition).xyz, 1.0);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// x0 = scaled x coordinate of pixel (scaled to lie in the Mandelbrot X scale (-2.5, 1))\n\t\t\tfloat x0 = vTexturePosition.x * 3.5 - 2.5;\n      //  y0 = scaled y coordinate of pixel (scaled to lie in the Mandelbrot Y scale (-1, 1))\n\t\t\tfloat y0 = vTexturePosition.y * 2.0 - 1.0;\n      //  x = 0.0\n      //  y = 0.0\n      //  iteration = 0\n      //  max_iteration = 1000\n\t\t\tfloat x = (texture(uSampler, vTexturePosition).x) * 3.5 - 2.5;\n\t\t\tfloat y = (texture(uSampler, vTexturePosition).y) * 2.0 - 1.0;\n\t\t\tif (uIteration == 0) {\n\t\t\t\tx = 0.0;\n\t\t\t\ty = 0.0;\n\t\t\t}\n\t\t\t//  while (x*x + y*y < 2*2  AND  iteration < max_iteration) {\n      //    xtemp = x*x - y*y + x0\n      //    y = 2*x*y + y0\n      //    x = xtemp\n      //    iteration = iteration + 1\n      //  }\n\t\t\tif (x*x + y*y >= 1.0) {\n\t\t\t\tfragmentColor = vec4(0,0,float(uIteration)/255.0,1.0);\n\t\t\t} else {\n\t\t\t\tfloat xTemp = x*x - y*y + x0;\n\t\t\t\ty = 2.0*x*y + y0;\n\t\t\t\tx = xTemp;\n\t\t\t\tfragmentColor = vec4((x + 2.5)/3.5, (y + 1.0)/2.0, 0, 1.0);\n\t\t\t}\n\t\t}\n\t"};e["default"]=r},22:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(){m.draw(v.stateTexture()),x||(v.incrementState(),requestAnimationFrame(i))}var o=(r(1),r(4)),a=n(o),u=r(3),s=n(u),f=r(18),c=n(f),l=r(2),h=n(l);console.log("🐭");var d=document.createElement("canvas");document.body.appendChild(d);var T=d.getContext("webgl2"),v=new a["default"]({shaderSource:c["default"]}),m=new s["default"]({shaderSource:h["default"]});T.clearColor(0,0,0,1),T.clear(T.COLOR_BUFFER_BIT);var E=Array(T.canvas.width*T.canvas.height*4).fill(0);console.time("Init"),v.setState(new ImageData(new Uint8ClampedArray(E),T.canvas.width,T.canvas.height)),console.timeEnd("Init");var x=!0;requestAnimationFrame(i),T.canvas.addEventListener("click",function(t){v.incrementState(),i()}),document.addEventListener("keypress",function(t){console.log(t),"p"==t.key&&(x=!x),i()})}});
//# sourceMappingURL=mandelbrot.js.map